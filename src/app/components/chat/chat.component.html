@if (currentUser) {
  <div class="main-container">
    <div class="chat-component">
      <div class="chat-list">
        <button
          class="new-chat-btn"
          mat-icon-button
          color="primary"
          (click)="startNewChat(currentUser.uid)"
        >
          <mat-icon>add</mat-icon>
        </button>
        <div class="list">
          @for (chat of chats$ | async; track $index) {
            <mat-card
              appearance="outlined"
              class="chat-card"
              (click)="onChatClick(chat)"
            >
              <mat-card-content class="chat-card-content">
                @for (participant of chat.participants; track $index) {
                  @if (participant.id !== currentUser.uid) {
                    <span>{{ participant.username }}</span>
                  }
                }
              </mat-card-content>
            </mat-card>
          }
        </div>
      </div>
      <div class="chat-section">
        @if (selectedChat) {
          <div class="chat-header">
            <h2>
              @for (
                participant of selectedChat.participants;
                track $index;
                let last = $last
              ) {
                @if (participant.id !== currentUser.uid) {
                  <span>{{ participant.username }}</span>
                  @if (!last) {
                    <span>, </span>
                  }
                }
              }
            </h2>
          </div>
          <div class="message-list" #messageList>
            @if (selectedChat.id) {
              @for (message of messages | async; track $index) {
                @if (message.sender.id === currentUser.uid) {
                  <app-message
                    class="message-right"
                    [message]="message"
                  ></app-message>
                } @else {
                  <div class="left-message-block">
                    <div>
                      {{ message.sender.username }}
                    </div>
                    <app-message
                      class="message-left"
                      [message]="message"
                    ></app-message>
                  </div>
                }
              }
            }
          </div>
          <div class="message-creation">
            <form class="message-form" [formGroup]="messageForm">
              <!--              <mat-form-field appearance="outline" class="full-width">-->
              <textarea
                id="message"
                formControlName="message"
                placeholder="Message..."
                matInput
                cdkTextareaAutosize
                cdkAutosizeMinRows="1"
                type="text"
                (keydown.enter)="onSendMessage($event)"
              ></textarea>
              <!--              </mat-form-field>-->
            </form>
          </div>
        } @else {
          <p>Select a contact</p>
        }
      </div>
    </div>
  </div>
}
